{% extends "base.html" %}

{% block title %}Home - {{ app_name }}{% endblock %}

{% block extra_head %}
<style>
    .pill-filter {
        padding: 10px 20px;
        border-radius: 9999px;
        border: 2px solid #e5e7eb;
        background: white;
        color: #4b5563;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 14px;
    }

    .pill-filter:hover {
        border-color: #1f2937;
        background: #f9fafb;
    }

    .pill-filter.active {
        background: #1f2937;
        color: white;
        border-color: #1f2937;
    }

    .user-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border: 1px solid #e5e7eb;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .user-card:hover {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        transform: translateY(-5px);
    }

    .skill-tag {
        display: inline-block;
        padding: 6px 12px;
        background: #f3f4f6;
        color: #374151;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        margin: 4px;
    }

    .pagination-btn {
        padding: 10px 16px;
        border: 1px solid #e5e7eb;
        background: white;
        color: #374151;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 500;
    }

    .pagination-btn:hover:not(:disabled) {
        background: #1f2937;
        color: white;
        border-color: #1f2937;
    }

    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .pagination-btn.active {
        background: #1f2937;
        color: white;
        border-color: #1f2937;
    }

    .loading-spinner {
        border: 3px solid #f3f4f6;
        border-top: 3px solid #1f2937;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 40px auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .faq-toggle:focus {
        outline: none;
    }
</style>
{% endblock %}

{% block content %}

<!-- Search and Filter Section -->
<section class="py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <div class="mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
                Find Skilled Workers Near You
            </h1>
            <p class="text-lg text-gray-600 mb-8">
                Search and filter through our community of talented professionals
            </p>
        </div>

        <!-- Search Box -->
        <div class="max-w-2xl mx-auto mb-8">
            <div class="relative">
                <input
                    type="text"
                    id="search-input"
                    placeholder="Search by name, location, skills, or description..."
                    class="w-full px-6 py-4 pr-12 text-base rounded-lg border-2 border-gray-300 focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/20 transition-all duration-200 bg-white shadow-sm"
                />
                <button id="search-btn" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-900 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Filter Pills -->
        <div class="max-w-4xl mx-auto mb-12">
            <div id="skill-filters" class="flex flex-wrap justify-center gap-3">
                <button class="pill-filter active" data-skill="all">All</button>
                <!-- Dynamic skill pills will be loaded here -->
            </div>
        </div>

        <!-- Results Count -->
        <div class="mb-6">
            <p class="text-gray-600 text-center" id="results-count">Loading...</p>
        </div>

        <!-- Loading Spinner -->
        <div id="loading-spinner" class="loading-spinner" style="display: none;"></div>

        <!-- User Cards Grid -->
        <div id="users-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            <!-- Cards will be dynamically loaded here -->
        </div>

        <!-- No Results Message -->
        <div id="no-results" class="text-center py-12" style="display: none;">
            <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">No workers found</h3>
            <p class="text-gray-500">Try adjusting your search or filters</p>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex justify-center items-center space-x-2">
            <!-- Pagination buttons will be dynamically loaded here -->
        </div>
    </div>
</section>

<!-- Testimonials Section -->
<section id="testimonials-section" class="py-24 bg-white">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex justify-center items-center gap-y-8 lg:gap-y-0 flex-wrap md:flex-wrap lg:flex-nowrap lg:flex-row lg:justify-between lg:gap-x-8 max-w-sm sm:max-w-2xl lg:max-w-full mx-auto">
            <div class="w-full lg:w-2/5">
                <span class="text-sm text-gray-500 font-medium mb-4 block">Testimonial</span>
                <h2 class="text-4xl font-bold text-gray-900 leading-[3.25rem] mb-8">23k+ Customers gave their <span class="text-transparent bg-clip-text bg-gradient-to-tr from-indigo-600 to-violet-600">Feedback</span></h2>
                <!-- Slider controls -->
                <div class="flex items-center justify-center lg:justify-start gap-10">
                    <button id="slider-button-left" >
                        <svg class="h-6 w-6 text-indigo-600 group-hover:text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.9999 12L4.99992 12M9.99992 6L4.70703 11.2929C4.3737 11.6262 4.20703 11.7929 4.20703 12C4.20703 12.2071 4.3737 12.3738 4.70703 12.7071L9.99992 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                    <button id="slider-button-right" >
                        <svg class="h-6 w-6 text-indigo-600 group-hover:text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 12L19 12M14 18L19.2929 12.7071C19.6262 12.3738 19.7929 12.2071 19.7929 12C19.7929 11.7929 19.6262 11.6262 19.2929 11.2929L14 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="w-full lg:w-3/5">
                <!--Slider wrapper-->
                <div class="swiper mySwiper">
                    <div class="swiper-wrapper">
                        {% for testimonial in testimonials %}
                        <div class="swiper-slide group bg-white border border-solid border-gray-300 rounded-2xl p-5 transition-all duration-500 hover:border-indigo-600">
                            <div class="flex items-center gap-4 mb-4">
                                <img class="w-10 h-10 rounded-full object-cover" src="{{ testimonial.avatar }}" alt="{{ testimonial.name }}">
                                <div class="grid gap-1">
                                    <h5 class="text-gray-900 font-medium text-sm">{{ testimonial.name }}</h5>
                                    <span class="text-xs leading-5 text-gray-500">{{ testimonial.title }}</span>
                                </div>
                            </div>
                            <div class="flex items-center mb-4 gap-1 text-amber-500">
                                <svg class="w-4 h-4" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8.10326 1.31699C8.47008 0.57374 9.52992 0.57374 9.89674 1.31699L11.7063 4.98347C11.8519 5.27862 12.1335 5.48319 12.4592 5.53051L16.5054 6.11846C17.3256 6.23765 17.6531 7.24562 17.0596 7.82416L14.1318 10.6781C13.8961 10.9079 13.7885 11.2389 13.8442 11.5632L14.5353 15.5931C14.6754 16.41 13.818 17.033 13.0844 16.6473L9.46534 14.7446C9.17402 14.5915 8.82598 14.5915 8.53466 14.7446L4.91562 16.6473C4.18199 17.033 3.32456 16.41 3.46467 15.5931L4.15585 11.5632C4.21148 11.2389 4.10393 10.9079 3.86825 10.6781L0.940384 7.82416C0.346867 7.24562 0.674378 6.23765 1.4946 6.11846L5.54081 5.53051C5.86652 5.48319 6.14808 5.27862 6.29374 4.98347L8.10326 1.31699Z" fill="currentColor"></path>
                                </svg>
                                <svg class="w-4 h-4" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8.10326 1.31699C8.47008 0.57374 9.52992 0.57374 9.89674 1.31699L11.7063 4.98347C11.8519 5.27862 12.1335 5.48319 12.4592 5.53051L16.5054 6.11846C17.3256 6.23765 17.6531 7.24562 17.0596 7.82416L14.1318 10.6781C13.8961 10.9079 13.7885 11.2389 13.8442 11.5632L14.5353 15.5931C14.6754 16.41 13.818 17.033 13.0844 16.6473L9.46534 14.7446C9.17402 14.5915 8.82598 14.5915 8.53466 14.7446L4.91562 16.6473C4.18199 17.033 3.32456 16.41 3.46467 15.5931L4.15585 11.5632C4.21148 11.2389 4.10393 10.9079 3.86825 10.6781L0.940384 7.82416C0.346867 7.24562 0.674378 6.23765 1.4946 6.11846L5.54081 5.53051C5.86652 5.48319 6.14808 5.27862 6.29374 4.98347L8.10326 1.31699Z" fill="currentColor"></path>
                                </svg>
                                <svg class="w-4 h-4" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8.10326 1.31699C8.47008 0.57374 9.52992 0.57374 9.89674 1.31699L11.7063 4.98347C11.8519 5.27862 12.1335 5.48319 12.4592 5.53051L16.5054 6.11846C17.3256 6.23765 17.6531 7.24562 17.0596 7.82416L14.1318 10.6781C13.8961 10.9079 13.7885 11.2389 13.8442 11.5632L14.5353 15.5931C14.6754 16.41 13.818 17.033 13.0844 16.6473L9.46534 14.7446C9.17402 14.5915 8.82598 14.5915 8.53466 14.7446L4.91562 16.6473C4.18199 17.033 3.32456 16.41 3.46467 15.5931L4.15585 11.5632C4.21148 11.2389 4.10393 10.9079 3.86825 10.6781L0.940384 7.82416C0.346867 7.24562 0.674378 6.23765 1.4946 6.11846L5.54081 5.53051C5.86652 5.48319 6.14808 5.27862 6.29374 4.98347L8.10326 1.31699Z" fill="currentColor"></path>
                                </svg>
                                <svg class="w-4 h-4" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8.10326 1.31699C8.47008 0.57374 9.52992 0.57374 9.89674 1.31699L11.7063 4.98347C11.8519 5.27862 12.1335 5.48319 12.4592 5.53051L16.5054 6.11846C17.3256 6.23765 17.6531 7.24562 17.0596 7.82416L14.1318 10.6781C13.8961 10.9079 13.7885 11.2389 13.8442 11.5632L14.5353 15.5931C14.6754 16.41 13.818 17.033 13.0844 16.6473L9.46534 14.7446C9.17402 14.5915 8.82598 14.5915 8.53466 14.7446L4.91562 16.6473C4.18199 17.033 3.32456 16.41 3.46467 15.5931L4.15585 11.5632C4.21148 11.2389 4.10393 10.9079 3.86825 10.6781L0.940384 7.82416C0.346867 7.24562 0.674378 6.23765 1.4946 6.11846L5.54081 5.53051C5.86652 5.48319 6.14808 5.27862 6.29374 4.98347L8.10326 1.31699Z" fill="currentColor"></path>
                                </svg>
                                <svg class="w-4 h-4" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8.10326 1.31699C8.47008 0.57374 9.52992 0.57374 9.89674 1.31699L11.7063 4.98347C11.8519 5.27862 12.1335 5.48319 12.4592 5.53051L16.5054 6.11846C17.3256 6.23765 17.6531 7.24562 17.0596 7.82416L14.1318 10.6781C13.8961 10.9079 13.7885 11.2389 13.8442 11.5632L14.5353 15.5931C14.6754 16.41 13.818 17.033 13.0844 16.6473L9.46534 14.7446C9.17402 14.5915 8.82598 14.5915 8.53466 14.7446L4.91562 16.6473C4.18199 17.033 3.32456 16.41 3.46467 15.5931L4.15585 11.5632C4.21148 11.2389 4.10393 10.9079 3.86825 10.6781L0.940384 7.82416C0.346867 7.24562 0.674378 6.23765 1.4946 6.11846L5.54081 5.53051C5.86652 5.48319 6.14808 5.27862 6.29374 4.98347L8.10326 1.31699Z" fill="currentColor"></path>
                                </svg>
                            </div>
                            <p class="text-xs text-gray-500 leading-5 group-hover:text-gray-800">
                                "{{ testimonial.quote }}"
                            </p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- FAQ Section -->
<section id="faq-section" class="py-16 px-4 sm:px-6 lg:px-8 ">
    <div class="max-w-4xl mx-auto">
        <div class="mb-10 text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Frequently Asked Questions</h2>
            <p class="text-gray-600 mt-2">Answers to common questions</p>
        </div>

        <div class="space-y-4">
            {% for faq in faqs %}
            <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                <button class="w-full text-left px-5 py-4 flex justify-between items-center hover:bg-gray-50 faq-toggle" onclick="toggleFaq('faq-{{ loop.index0 }}')">
                    <span class="font-medium text-gray-900">{{ faq.question }}</span>
                    <svg class="w-5 h-5 text-gray-500 transition-transform faq-icon" id="icon-faq-{{ loop.index0 }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="faq-{{ loop.index0 }}" class="px-5 pb-4 hidden">
                    <p class="text-gray-700">{{ faq.answer }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-16 px-4 sm:px-6 lg:px-8 bg-gradient-to-r from-primary to-secondary">
    <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
            Ready to Find Your Perfect Helper?
        </h2>
        <p class="text-white/90 text-lg mb-8">
            Join thousands of satisfied customers who found skilled workers through our platform
        </p>
        <a href="#" class="inline-block bg-white text-primary px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
            Get Started Now
        </a>
    </div>
</section>

{% endblock %}

{% block extra_scripts %}
<script>
    let currentPage = 1;
    let currentSearch = '';
    let selectedSkills = [];  // Changed to array for multiple selection
    const itemsPerPage = 9;
    let searchDebounceTimer = null; // Timer for debouncing search

    // Load and render skill filter pills
    async function loadSkillFilters() {
        try {
            const response = await fetch('/api/skills');
            const data = await response.json();

            if (data.success && data.skills && data.skills.length > 0) {
                const filterContainer = document.getElementById('skill-filters');
                const allButton = filterContainer.querySelector('[data-skill="all"]');

                // Add skill pills after "All" button
                data.skills.forEach(skill => {
                    const button = document.createElement('button');
                    button.className = 'pill-filter';
                    button.setAttribute('data-skill', skill);
                    button.textContent = skill;
                    filterContainer.appendChild(button);
                });

                // Attach click handlers to all filter buttons
                attachFilterHandlers();
            }
        } catch (error) {
            console.error('Error loading skills:', error);
        }
    }

    // Attach click handlers to filter buttons
    function attachFilterHandlers() {
        const filterBtns = document.querySelectorAll('.pill-filter');
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const skill = btn.getAttribute('data-skill');

                if (skill === 'all') {
                    // Clear all selections
                    selectedSkills = [];
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                } else {
                    // Remove "All" button active state
                    const allBtn = document.querySelector('[data-skill="all"]');
                    allBtn.classList.remove('active');

                    // Toggle this skill
                    if (selectedSkills.includes(skill)) {
                        // Remove skill
                        selectedSkills = selectedSkills.filter(s => s !== skill);
                        btn.classList.remove('active');

                        // If no skills selected, activate "All"
                        if (selectedSkills.length === 0) {
                            allBtn.classList.add('active');
                        }
                    } else {
                        // Add skill
                        selectedSkills.push(skill);
                        btn.classList.add('active');
                    }
                }

                currentPage = 1;
                loadAndDisplayUsers();
            });
        });
    }

    // Render user cards
    function renderUserCards(users) {
        const grid = document.getElementById('users-grid');

        if (users.length === 0) {
            grid.innerHTML = '';
            document.getElementById('no-results').style.display = 'block';
            return;
        }

        document.getElementById('no-results').style.display = 'none';

        grid.innerHTML = users.map(user => `
            <div class="user-card">
                <div class="flex items-center mb-4">
                    <img src="${user.avatar}" alt="${user.name}" class="w-16 h-16 rounded-full mr-4">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">${user.name}</h3>
                        <p class="text-sm text-gray-500 flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            ${user.location}
                        </p>
                    </div>
                </div>

                <p class="text-gray-600 text-sm mb-4 flex-grow">${user.description}</p>

                <div class="mb-4">
                    <p class="text-xs font-semibold text-gray-500 mb-2">SKILLS</p>
                    <div class="flex flex-wrap -m-1">
                        ${user.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                    </div>
                </div>

                <div class="border-t pt-4 mt-auto">
                    <div class="flex items-center justify-between text-sm text-gray-600 mb-3">
                        <span class="flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                            ${user.experience}
                        </span>
                    </div>
                    <div class="flex space-x-2">
                        <a href="tel:${user.phone}" class="flex-1 bg-gray-900 text-white text-center py-2 px-4 rounded-lg hover:bg-gray-800 transition-colors text-sm font-medium">
                            Contact
                        </a>
                        <a href="mailto:${user.email}" class="flex-1 border border-gray-300 text-gray-700 text-center py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium">
                            Email
                        </a>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Render pagination
    function renderPagination(totalItems, currentPage, itemsPerPage) {
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        const pagination = document.getElementById('pagination');

        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }

        let html = '';

        // Previous button
        html += `
            <button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="goToPage(${currentPage - 1})">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
        `;

        // Page numbers
        const maxVisible = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
        let endPage = Math.min(totalPages, startPage + maxVisible - 1);

        if (endPage - startPage < maxVisible - 1) {
            startPage = Math.max(1, endPage - maxVisible + 1);
        }

        if (startPage > 1) {
            html += `<button class="pagination-btn" onclick="goToPage(1)">1</button>`;
            if (startPage > 2) {
                html += `<span class="px-2 text-gray-500">...</span>`;
            }
        }

        for (let i = startPage; i <= endPage; i++) {
            html += `
                <button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">
                    ${i}
                </button>
            `;
        }

        if (endPage < totalPages) {
            if (endPage < totalPages - 1) {
                html += `<span class="px-2 text-gray-500">...</span>`;
            }
            html += `<button class="pagination-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
        }

        // Next button
        html += `
            <button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="goToPage(${currentPage + 1})">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>
        `;

        pagination.innerHTML = html;
    }

    // Update results count
    function updateResultsCount(total, showing) {
        const resultsCount = document.getElementById('results-count');
        resultsCount.textContent = `Showing ${showing} of ${total} workers`;
    }

    // Load and display users
    async function loadAndDisplayUsers() {
        const loadingSpinner = document.getElementById('loading-spinner');
        const grid = document.getElementById('users-grid');

        loadingSpinner.style.display = 'block';
        grid.style.opacity = '0.5';

        try {
            // Build API URL with parameters
            let url = `/api/users?page=${currentPage}&limit=${itemsPerPage}`;

            if (currentSearch) {
                url += `&search=${encodeURIComponent(currentSearch)}`;
            }

            if (selectedSkills.length > 0) {
                url += `&skills=${encodeURIComponent(selectedSkills.join(','))}`;
            }

            const response = await fetch(url);
            const data = await response.json();

            if (data.success) {
                renderUserCards(data.users);
                renderPagination(data.total, currentPage, itemsPerPage);
                updateResultsCount(data.total, data.users.length);
            } else {
                console.error('Error loading users:', data.error);
                document.getElementById('no-results').style.display = 'block';
                grid.innerHTML = '';
            }
        } catch (error) {
            console.error('Error loading users:', error);
            document.getElementById('no-results').style.display = 'block';
            grid.innerHTML = '';
        }

        loadingSpinner.style.display = 'none';
        grid.style.opacity = '1';

        // Scroll to top of results
        window.scrollTo({ top: 300, behavior: 'smooth' });
    }

    // Go to page
    window.goToPage = function(page) {
        currentPage = page;
        loadAndDisplayUsers();
    };

    // FAQ Toggle
    function toggleFaq(id) {
        const panel = document.getElementById(id);
        const icon = document.getElementById('icon-' + id);

        if (panel.classList.contains('hidden')) {
            panel.classList.remove('hidden');
            icon.style.transform = 'rotate(180deg)';
        } else {
            panel.classList.add('hidden');
            icon.style.transform = 'rotate(0deg)';
        }
    }

    // Initialize Swiper
    var swiper = new Swiper(".mySwiper", {
        slidesPerView: 2,
        spaceBetween: 28,
        centeredSlides: false,
        loop: true,
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
        breakpoints: {
            0: {
                slidesPerView: 1,
                spaceBetween: 20,
                centeredSlides: false,
            },
            768: {
                slidesPerView: 2,
                spaceBetween: 28,
                centeredSlides: false,
            },
            1024: {
                slidesPerView: 2,
                spaceBetween: 32,
            },
        },
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
        // Load skill filters first
        await loadSkillFilters();

        // Load initial users
        loadAndDisplayUsers();

        // Search functionality with debouncing
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');

        // Debounced search input - waits for user to stop typing
        searchInput.addEventListener('input', (e) => {
            currentSearch = e.target.value;
            currentPage = 1;

            // Clear existing timer
            if (searchDebounceTimer) {
                clearTimeout(searchDebounceTimer);
            }

            // Set new timer - API call will happen after 500ms of no typing
            searchDebounceTimer = setTimeout(() => {
                loadAndDisplayUsers();
            }, 500); // 500ms delay - adjust as needed
        });

        // Immediate search on button click
        searchBtn.addEventListener('click', () => {
            // Clear any pending debounced search
            if (searchDebounceTimer) {
                clearTimeout(searchDebounceTimer);
            }
            loadAndDisplayUsers();
        });

        // Immediate search on Enter key
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                // Clear any pending debounced search
                if (searchDebounceTimer) {
                    clearTimeout(searchDebounceTimer);
                }
                loadAndDisplayUsers();
            }
        });
    });
</script>
{% endblock %}





                                            
